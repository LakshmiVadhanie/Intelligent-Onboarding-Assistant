FROM python:3.9-slim

WORKDIR /app

COPY requirements.ui.txt /tmp/requirements.txt
RUN pip install --no-cache-dir -r /tmp/requirements.txt

# PRE-DOWNLOAD the sentence-transformers model during build
# This uses Google Cloud Build's IP, not your blocked IP
RUN python -c "from sentence_transformers import SentenceTransformer; \
    print('Downloading sentence-transformers model...'); \
    model = SentenceTransformer('sentence-transformers/all-mpnet-base-v2'); \
    print('âœ… Model cached successfully in Docker image')"

COPY . .

EXPOSE 8080

ENTRYPOINT ["streamlit", "run", "/app/Model_Pipeline/app.py", \
            "--server.port=8080", \
            "--server.address=0.0.0.0", \
            "--server.headless=true", \
            "--browser.serverAddress=0.0.0.0", \
            "--browser.gatherUsageStats=false"]
